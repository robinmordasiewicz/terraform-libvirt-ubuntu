#cloud-config
# vim: syntax=yaml
package_update: true
package_upgrade: true
hostname: workstation
fqdn: workstation.example.com
prefer_fqdn_over_hostname: true
power_state:
  mode: reboot
  delay: now
  message: Rebooting the OS
  condition: if [ -e /var/run/reboot-required ]; then exit 0; else exit 1; fi
package_reboot_if_required: True
ssh_pwauth: true
password: ubuntu
chpasswd: {expire: False}
apt:
  sources:
      powershell:
          source: "deb [arch=amd64 signed-by=$KEY_FILE] https://packages.microsoft.com/ubuntu/22.04/prod jammy main"
          keyid: "EB3E94ADBE1229CF"
      vscode:
          source: "deb [arch=amd64 signed-by=$KEY_FILE] https://packages.microsoft.com/repos/vscode stable main"
          keyid: "EB3E94ADBE1229CF"
      kubernetes:
          source: "deb [arch=amd64 signed-by=$KEY_FILE] https://apt.kubernetes.io/ kubernetes-xenial main"
          keyid: "B53DC80D13EDEF05"
      docker: 
          source: "deb [arch=amd64 signed-by=$KEY_FILE] https://download.docker.com/linux/ubuntu jammy stable"
          keyid: "8D81803C0EBFCD88"
      github-cli:
          source: "deb [arch=amd64 signed-by=$KEY_FILE] https://cli.github.com/packages stable main"
          keyid: "23F3D4EA75716059"
      hashicorp:
          source: "deb [signed-by=$KEY_FILE] https://apt.releases.hashicorp.com jammy main"
          keyid: "AA16FCBCA621E701"
system_info:
  default_user:
    name: ubuntu
    shell: /bin/zsh
    primary_group: dialout
    no_user_group: true
    lock_passwd: false
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: [adm, audio, cdrom, dialout, floppy, video, plugdev, dip, netdev, libvirtd, docker]
users:
  - default
packages:
  - qemu-guest-agent
  - vim
  - git
  - zsh
  - software-properties-common
  - gnupg2
  - curl
  - apt-transport-https 
  - gnupg-agent
  - ca-certificates
  - lsb-release
  - bash-completion
  - wget
  - jq
  - yamllint
  - moreutils
  - python3-sphinx
  - python3-pip
  - python3.9
  - build-essential
  - fonts-powerline
  - powerline
  - fzf
  - speedtest-cli
  - kubectl
  - docker-ce
  - gh
  - terraform
  - code
  - powershell
  - byobu
runcmd:
  - [ sysctl, -w, net.ipv6.conf.all.disable_ipv6=1 ]
  - [ sysctl, -w, net.ipv6.conf.default.disable_ipv6=1 ]
  - [ sysctl, -w, net.ipv6.conf.lo.disable_ipv6=1 ]
  - [ systemctl, daemon-reload ]
  - [ systemctl, start, qemu-guest-agent ]
  - [ systemctl, enable, docker ]
  - [ systemctl, start, docker ]
  - curl -LO "https://vesio.azureedge.net/releases/vesctl/$(curl -s https://downloads.volterra.io/releases/vesctl/latest.txt)/vesctl.linux-amd64.gz"
  - gunzip vesctl.linux-amd64.gz
  - mv vesctl.linux-amd64 /usr/local/bin/vesctl
  - chown root:root /usr/local/bin/vesctl
  - chmod 755 /usr/local/bin/vesctl
  - vesctl completion bash > /etc/bash_completion.d/vesctl > /dev/null
  - pip3 install sphobjinv
  - 'usermod -u 502 ubuntu'
  - 'groupmod -n ubuntu dialout'
  - 'su -l -s /bin/zsh -c byobu-enable ubuntu'
  - 'chown -R ubuntu:ubuntu /home/ubuntu'
write_files:
  - path: /etc/sysctl.d/10-disable-ipv6.conf
    permissions: '0644'
    owner: root
    content: |
      net.ipv6.conf.all.disable_ipv6 = 1
      net.ipv6.conf.default.disable_ipv6 = 1
      net.ipv6.conf.lo.disable_ipv6 = 1
ansible:
  install_method: distro
  package_name: ansible
  run_user: ubuntu
  galaxy:
    actions:
      - ["ansible-galaxy", "install", "gantsign.oh-my-zsh"]
  pull:
    url: "https://github.com/robinmordasiewicz/linux-userland.git"
    playbook_name: "userland.yml"
